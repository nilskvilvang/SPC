---
bibliography: referanser.bib 
---

# R kode {.unnumbered}

## Kapittel 2 {.unnumbered}

Sette opp nødvendige pakker:
```{r echo = TRUE, eval=FALSE}
pacman::p_load(ggplot2, readxl, tidyverse, ggpubr, dplyr, hrbrthemes)
```

Lage fig 2.1:
```{r echo = TRUE, eval=FALSE}
prepost_eksempel_long <- as_tibble(read_excel("prepost_eksempel_long.xlsx"))

ggbarplot(prepost_eksempel_long, x = "Periode", y = "Verdi", add = c("mean"), color = "blue", fill = "lightblue")
```

Lage fig 2.2:
```{r echo = TRUE, eval=FALSE}
ggline(prepost_eksempel_long, x = "Periode", y = "Verdi", add = c("mean_se", "jitter"))
```

Lage fig 2.3:
```{r echo = TRUE, eval=FALSE}
t <- 1:24

z <- c(prepost_eksempel_long$Verdi)
  
plot(t,z, type="l", col="blue", lwd=3, xlab="Periode", ylab="Antall", xaxt="n")
axis(1, seq(0,24,2))

abline(v=12, col="red", lwd = 3)
text(15.5, 40, "Endring i prosedyre", col = "red")
```

## Kapittel 3 {.unnumbered}

Lage fig 3.1:
```{r echo = TRUE, eval=FALSE}

# Genererer tilfeldig tall for regel 1:

pacman::p_load(xlsx, ggplot2, tidyverse, ggpubr)

set.seed(91)

regel1_x <- as_tibble(rnorm(100, mean = 0, sd = 1)) %>%
  rename(x = value) %>%
  add_column(nr = 1:100) %>%
  relocate(nr)

regel1_y <- as_tibble(rnorm(100, mean = 0, sd = 1)) %>%
  rename(y = value) %>%
  add_column(nr = 1:100) %>%
  relocate(nr)

regel1 <- merge(regel1_x,regel1_y,by="nr")

regel1_plot <- ggplot(regel1, aes(x = x, y = y)) +
  geom_point(size = 1) + labs(x = "x", y = "y", title = "Regel 1") + xlim(-5,5) + ylim(-5,5)+ geom_vline(xintercept = 0, col = "red") + geom_hline(yintercept = 0, col = "red")

# Genererer tilfeldig tall for regel 2:

set.seed(92)

regel2_x <- as_tibble(rnorm(100, mean = 0, sd = 2)) %>%
  rename(x = value) %>%
  add_column(nr = 1:100) %>%
  relocate(nr)

## Setter sd = 2 fordi variasjonen med regel 2 er dobbel av regel 1 (jfr SPC for Excel)

regel2_y <- as_tibble(rnorm(100, mean = 0, sd = 2)) %>%
  rename(y = value) %>%
  add_column(nr = 1:100) %>%
  relocate(nr)

regel2 <- merge(regel2_x,regel2_y,by="nr")

regel2_plot <- ggplot(regel2, aes(x = x, y = y)) +
  geom_point(size = 1) + labs(x = "x", y = "y", title = "Regel 2") + xlim(-5,5) + ylim(-5,5) + geom_vline(xintercept = 0, col = "red") + geom_hline(yintercept = 0, col = "red")

# Henter tall fra Excel for regel 3:

regel3 <- read.xlsx("Funnel_blankedata_regel3.xlsx", 1)

regel3_plot <- ggplot(regel3, aes(x = Regel_3_x, y = Regel_3_y)) +
  geom_point(size = 1) + labs(x = "x", y = "y", title = "Regel 3") + xlim(-5,5) + ylim(-5,5)+ geom_vline(xintercept = 0, col = "red") + geom_hline(yintercept = 0, col = "red")

# Henter tall fra Excel for regel 4:

regel4 <- read.xlsx("Funnel_blankedata_regel4.xlsx", 1)

regel4_plot <- ggplot(regel4, aes(x = Regel_4_x, y = Regel_4_y)) +
  geom_point(size = 1) + labs(x = "x", y = "y", title = "Regel 4") + xlim(-5,5) + ylim(-5,5)+ geom_vline(xintercept = 0, col = "red") + geom_hline(yintercept = 0, col = "red")

# Setter plottene sammen:

ggarrange(regel1_plot, regel2_plot, regel3_plot, regel4_plot 
 + rremove("x.text"), ncol = 2, nrow = 2)

```

Lage fig 3.2:
```{r echo = TRUE, eval=FALSE}

regel3_2 <- read.xlsx("Funnel_blankedata_regel3_2.xlsx", 1)

regel3_2_plot <- ggplot(regel3_2, aes(x = x, y = y)) +
  geom_point(size = 1) + labs(x = "x", y = "y", title = "Regel 3 - annet førstetreff") + xlim(-5,5) + ylim(-5,5)+ geom_vline(xintercept = 0, col = "red") + geom_hline(yintercept = 0, col = "red")

regel3_2_plot 

```

Lage fig 3.3:

```{r echo = TRUE, eval=FALSE}

regel4_2 <- read.xlsx("Funnel_blankedata_regel4_2.xlsx", 1)

regel4_2_plot <- ggplot(regel4_2, aes(x = x, y = y)) +
  geom_point(size = 1) + labs(x = "x", y = "y", title = "Regel 4 - annet førstetreff") + xlim(-2,10) + ylim(-10,2)+ geom_vline(xintercept = 0, col = "red") + geom_hline(yintercept = 0, col = "red")

regel4_2_plot
```

Lage fig 3.4:

```{r echo = TRUE, eval=FALSE}

pacman::p_load(qicharts2)

regel1x <- regel1 %>% pull(2)

regel1y <- regel1 %>% pull(3)

regel1xrun <- qic(regel1x, title = 'x-verdi ved regel 1', ylab = "verdi", xlab = "Forsøk nr.")

regel1yrun <- qic(regel1y, title = 'y-verdi ved regel 1', ylab = "verdi", xlab = "Forsøk nr.")

ggarrange(regel1xrun, regel1yrun + rremove("x.text"), ncol = 2, nrow = 1,  widths = c(1, 1))

```

Lage fig 3.5:

```{r echo = TRUE, eval=FALSE}

pacman::p_load(qicharts2)

regel2x <- regel2 %>% pull(2)

regel2y <- regel2 %>% pull(3)

regel2xrun <- qic(regel2x, title = 'x-verdi ved regel 2', ylab = "verdi", xlab = "Forsøk nr.")

regel2yrun <- qic(regel2y, title = 'y-verdi ved regel 2', ylab = "verdi", xlab = "Forsøk nr.")

ggarrange(regel2xrun, regel2yrun + rremove("x.text"), ncol = 2, nrow = 1,  widths = c(1, 1))

```

Lage fig 3.6:

```{r echo = TRUE, eval=FALSE}

pacman::p_load(qicharts2)

regel3x <- regel3 %>% pull(2)

regel3y <- regel3 %>% pull(3)

regel3xrun <- qic(regel3x, title = 'x-verdi ved regel 3', ylab = "verdi", xlab = "Forsøk nr.")

regel3yrun <- qic(regel3y, title = 'y-verdi ved regel 3', ylab = "verdi", xlab = "Forsøk nr.")

ggarrange(regel3xrun, regel3yrun + rremove("x.text"), ncol = 2, nrow = 1,  widths = c(1, 1))

```

Lage fig 3.7:

```{r echo = TRUE, eval=FALSE}

pacman::p_load(qicharts2)

regel4x <- regel4 %>% pull(2)

regel4y <- regel4 %>% pull(3)

regel4xrun <- qic(regel4x, title = 'x-verdi ved regel 4', ylab = "verdi", xlab = "Forsøk nr.")

regel4yrun <- qic(regel4y, title = 'y-verdi ved regel 4', ylab = "verdi", xlab = "Forsøk nr.")

ggarrange(regel4xrun, regel4yrun + rremove("x.text"), ncol = 2, nrow = 1,  widths = c(2, 2))

```

Lage fig 3.8:

```{r echo = TRUE, eval=FALSE}

pacman::p_load(xlsx, qicharts2, tidyverse, ggplot2, ggpubr)

toteam1 <- read.xlsx("toteam.xlsx", 1)

team1 <- qic(Team.1,
    data      = toteam1, 
    chart     = 'i',
    show.grid = TRUE,
    title     = "Team 1",
    ylab      = "Antall defekter pr uke",
    xlab      = "Uke #")

team2 <- qic(Team.2,
    data      = toteam1, 
    chart     = 'i',
    show.grid = TRUE,
    title     = "Team 2",
    ylab      = "Antall defekter pr uke",
    xlab      = "Uke #")

ggarrange(team1, team2 + rremove("x.text"), ncol = 2, nrow = 1,  widths = c(1, 1))
```

Lage fig 3.9:

```{r echo = TRUE, eval=FALSE}

pacman::p_load(xlsx, qicharts2, tidyverse, ggplot2, ggpubr)

toteam2 <- readxl::read_excel("toteam.xlsx") %>%
  pivot_longer(c("Team 1", "Team 2"))

qic(Nr, value,
    data = toteam2,
    facets = ~name,
    xlab = "Uke #",
    ylab = "Antall defekter pr uke",
    title = "To team - like prosesser - ulik variasjon")
```

## Kapittel 4 {.unnumbered}

Lage fig 4.1:

```{r echo = TRUE, eval=FALSE}

pacman::p_load(tidyverse)

set.seed(30)
x = rnorm(100, 179, 16)
hist(x, xlab = "Høyde", ylab = "Antall", main = "Histogram for genererte høydedata")
```

Lage fig 4.2:

```{r echo = TRUE, eval=FALSE}

data1 <- sample(165:175, 50, replace=TRUE)
data2 <- sample(170:180, 30, replace=TRUE)
data3 <- sample(180:185, 15, replace = TRUE)
data4 <- sample(185:190, 5, replace = TRUE)

data <- c(data1, data2, data3, data4)

hist(data, xlab = "Høyde", ylab = "Antall", main = "Histogram for genererte høydedata")
```

Lage fig 4.3:

```{r echo = TRUE, eval=FALSE}

pacman::p_load(ggplot2, readxl, tidyverse, ggfortify)

set.seed(100)

normalfordeling <- rnorm(100, mean = 0, sd = 1)

hist(normalfordeling, 
     main = "Genererte, normalfordelte data", 
     xlab = "x", 
     ylab = "f(x)",
     border = "black", 
     col = "gray",
     xlim = c(-4,4),
     ylim = c(0,0.5),
     las = 1, 
     probability = TRUE)
```

Lage fig 4.4:

```{r echo = TRUE, eval=FALSE}

set.seed(100)

normalfordeling <- rnorm(100, mean = 0, sd = 1)

hist(normalfordeling, 
     main = "Genererte, normalfordelte data", 
     xlab = "x", 
     ylab = "f(x)",
     border = "black", 
     col = "gray",
     xlim = c(-4,4),
     ylim = c(0,0.5),
     las = 1, 
     probability = TRUE)

m <- mean(normalfordeling)
std <- sqrt(var(normalfordeling))

curve(dnorm(x, mean = m, sd = std), 
      col="darkblue", lwd = 3, add = TRUE, yaxt = "n")

```

Lage fig 4.5:

```{r echo = TRUE, eval=FALSE}

pacman::p_load(ggplot2, readxl, tidyverse, ggfortify)

ggplot(data.frame(x = c(-4, 4)), aes(x)) +
  geom_function(fun = dnorm, colour = "darkblue", size = 1.5) +
  theme_classic() +
  scale_y_continuous(limits = c(0, 0.5), breaks = seq(0, 0.5, by = 0.1))

```

Lage fig 4.6:

```{r echo = TRUE, eval=FALSE}

x <- seq(-4, 4, length=200)
y <- dnorm(x)

plot(x, y, type="l", lty=1, lwd = 2, col = "red", xlab="x",
  ylab="f(x)")

x <- seq(-1,1,length=100)
y <- dnorm(x)

polygon(c(-1,x,1),c(0,y,0),col="lightblue")

abline(v=-1, col="green", lwd = 2)
text(1.3, 0.38, "1 SD", col = "black")
text(-1.35, 0.38, "-1 SD", col = "black")
abline(v=1, col="green", lwd = 2)

text(0, 0.2, "68 %", col = "black")
```

Lage fig 4.7:

```{r echo = TRUE, eval=FALSE}

x <- seq(-4,4,length=200)
y <- dnorm(x)

plot(x, y, type="l", lty=1, lwd = 2, col = "red", xlab="x",
  ylab="f(x)")

x <- seq(-2,2,length=200)
y <- dnorm(x)

polygon(c(-2,x,2),c(0,y,0),col="lightblue")

abline(v=-2, col="green", lwd = 2)
text(2.3, 0.38, "2 SD", col = "black")
text(-2.35, 0.38, "-2 SD", col = "black")
abline(v=2, col="green", lwd = 2)

text(0, 0.2, "95 %", col = "black")
```

Utregning av areal mellom to x-verdier i normalfordeling:

```{r echo = TRUE, eval=FALSE}

pnorm(2,mean=0,sd=1)-pnorm(-2,mean=0,sd=1)

```

Lage fig 4.8:

```{r echo = TRUE, eval=FALSE}

x <- seq(-4,4,length=200)
y <- dnorm(x)

plot(x,y,type="l",lwd=2,col="red", xlab="x",
  ylab="f(x)")

x <- seq(-3,3,length=200)
y <- dnorm(x)

polygon(c(-3,x,3),c(0,y,0),col="lightblue")

abline(v=-3, col="green", lwd = 2)
text(3.3, 0.38, "3 SD", col = "black")
text(-3.35, 0.38, "-3 SD", col = "black")
abline(v=3, col="green", lwd = 2)

text(0, 0.2, "99.7 %", col = "black")

```

Lage fig 4.9:

```{r echo = TRUE, eval=FALSE}

success <- 0:20

plot(success,dbinom(success,size=20,prob=.5),
     type='h',
     main="Binomial distribusjon (n=20, p=0.5)",
     ylab="Sannsynlighet",
     xlab = "Suksess",
     lwd=10)

```

Lage fig 4.10:

```{r echo = TRUE, eval=FALSE}

success <- 0:20

plot(success,dbinom(success,size=20,prob=.2),
     type='h',
     main="Binomial distribusjon (n=20, p=0.2)",
     ylab="Sannsynlighet",
     xlab = "Suksess",
     lwd=10)

```

Lage fig 4.11:

```{r echo = TRUE, eval=FALSE}

set.seed(32)

terning10 <- sample(1:6, 10, replace = TRUE)

stripchart(terning10, method = "stack", offset = .5, at = 0, pch = 19,
           col = "steelblue", main = "10 terningkast", xlab = "Verdi på terning", ylab = "Antall"))

```

Lage fig 4.12:

```{r echo = TRUE, eval=FALSE}

set.seed(33)

terning10 <- sample(1:6, 100, replace = TRUE)

stripchart(terning10, method = "stack", offset = .5, at = 0, pch = 19,
           col = "steelblue", main = "100 terningkast", xlab = "Verdi på terning", ylab = "Antall")

```

Lage simulering av terningkast:

```{r echo = TRUE, eval=FALSE}

set.seed(43)
terning_runde1 <- sample(1:6, 600, replace = TRUE)
table(terning_runde1)

set.seed(44)
terning_runde2 <- sample(1:6, 600, replace = TRUE)
table(terning_runde2)

set.seed(45)
terning_runde3 <- sample(1:6, 600, replace = TRUE)
table(terning_runde3)

```

Lage fig 4.13:

```{r echo = TRUE, eval=FALSE}

set.seed(46)
minterning <- sample(1:6, 6000000, replace = TRUE)

options(scipen=999)
hist(minterning,
     main="Histogram for 6 000 000 terningkast",
     ylab="Antall",
     xlab = "Verdi på terning")

```

Lage fig 4.14:

```{r echo = TRUE, eval=FALSE}

# Grid of X-axis values
x <- 0:50

#-----------
# lambda: 5
#-----------
lambda <- 5
plot(dpois(x, lambda), type = "h", lwd = 2,
     main = "Poisson sannsynlighetsfordeling",
     ylab = "P(X = x)", xlab = "Antall hendelser")

#-----------
# lambda: 10
#-----------
lambda <- 10
lines(dpois(x, lambda), type = "h", lwd = 2, col = rgb(1,0,0, 0.7))

#-----------
# lambda: 20
#-----------

lambda <- 20
lines(dpois(x, lambda), type = "h", lwd = 2, col = rgb(0, 1, 0, 0.7))

# Legend
legend("topright", legend = c("5", "10", "20"),
       title = expression(lambda), title.adj = 0.75,
       lty = 1, col = 1:3, lwd = 2, box.lty = 0)

```

Lage fig 4.15:

```{r echo = TRUE, eval=FALSE}

maal <- 0:10

plot(maal, dpois(maal, lambda=2.5),
     type='h',
     main='Poissonfordeling (lambda = 2.5)',
     ylab='Sannsynlighet',
     xlab ='# Mål',
     lwd=3)

```

Regne ut sannsynligheter:

```{r echo = TRUE, eval=FALSE}

# Sannsynligheten for 0 mål
dpois(x = 0, lambda = 2.5)

# Sannsynligheten for 1 mål
dpois(x = 1, lambda = 2.5)
      
# Sannsynligheten for 2 mål
dpois(x = 2, lambda = 2.5)
      
# Sannsynligheten for 3 mål
dpois(x = 3, lambda = 2.5)
      
# Sannsynligheten for 4 mål
dpois(x = 4, lambda = 2.5)
      
# sannsynligheten for mellom 1 og 3 mål:
dpois(x = 1, lambda = 2.5) + dpois(x=2, lambda = 2.5) + dpois(x=3, lambda = 2.5)

```

Lage fig 4.16:

```{r echo = TRUE, eval=FALSE}

pacman::p_load(ggpubr)

eksford <- seq(0, 20, length.out=1000)

dat1 <- data.frame(x=eksford, fx=dexp(eksford, rate=0.2)) %>%
  add_column(ID = 1:1000) %>%
  relocate(3)
             
dat2 <- data.frame(x=eksford, fx=dexp(eksford, rate=1)) %>%
  add_column(ID = 1:1000) %>%
  relocate(3)
             
dat3 <- data.frame(x=eksford, fx=dexp(eksford, rate=1.5)) %>%
  add_column(ID = 1:1000) %>%
  relocate(3)
             
dat4 <- data.frame(x=eksford, fx=dexp(eksford, rate=2)) %>%
  add_column(ID = 1:1000) %>%
  relocate(3)
             

dat1plot <- ggplot(dat1, aes(x=x, y=fx)) + geom_line() + ggtitle(expression( ~ lambda ~ " = 0.2"))
dat2plot <- ggplot(dat2, aes(x=x, y=fx)) + geom_line() + ggtitle(expression( ~ lambda ~ " = 1.0"))
dat3plot <- ggplot(dat3, aes(x=x, y=fx)) + geom_line() + ggtitle(expression( ~ lambda ~ " = 1.5"))
dat4plot <- ggplot(dat4, aes(x=x, y=fx)) + geom_line() + ggtitle(expression( ~ lambda ~ " = 2.0"))

ggarrange(dat1plot, dat2plot, dat3plot, dat4plot + rremove("x.text"), ncol = 2, nrow = 2,  widths = c(1, 1))

```